/*
*********************************************************************************************************
*                                               uC/LCD
*                                         LCD Module Driver
*
*                              (c) Copyright 2005; Micrium; Weston, FL
*
*                   All rights reserved.  Protected by international copyright laws.
*                   Knowledge of the source code may not be used to write a similar
*                   product.  This file may only be used in accordance with a license
*                   and should not be redistributed in any way.
*********************************************************************************************************
*/


/*
*********************************************************************************************************
*                                 LCD MODULE RTOS INTERFACE SOURCE FILE
*
* Filename      : lcd_os.c
* Programmer(s) : JJL
* Version       : V2.11
*********************************************************************************************************
*/

/*
*********************************************************************************************************
*                                              INCLUDE FILES
*********************************************************************************************************
*/

#include <os.h>

/*
*********************************************************************************************************
*                                            LOCAL DEFINES
*********************************************************************************************************
*/


/*
*********************************************************************************************************
*                                           LOCAL CONSTANTS
*********************************************************************************************************
*/


/*
*********************************************************************************************************
*                                          LOCAL DATA TYPES
*********************************************************************************************************
*/


/*
*********************************************************************************************************
*                                            LOCAL TABLES
*********************************************************************************************************
*/

/*
*********************************************************************************************************
*                                     LOCAL CONFIGURATION ERRORS
*********************************************************************************************************
*/

#ifndef  OS_CFG_MUTEX_EN
#error  "OS_CFG_MUTEX_EN                        not #define'd in 'os_cfg.h'     "
#error  "                                [MUST be  0u]                          "
#error  "                                [     ||  1u]                          "

#elif   OS_CFG_MUTEX_EN < 0u
#error  "OS_CFG_MUTEX_EN                  illegally #define'd in 'os_cfg.h'     "
#error  "                                [MUST be  0u]                          "
#error  "                                [     ||  1u]                          "
#endif


/*
*********************************************************************************************************
*                                       LOCAL GLOBAL VARIABLES
*********************************************************************************************************
*/

static  OS_MUTEX  DispLockMutex;                                /* Display driver lock.                                 */


/*
*********************************************************************************************************
*                                      LOCAL FUNCTION PROTOTYPES
*********************************************************************************************************
*/


/*
*********************************************************************************************************
*********************************************************************************************************
*                                           LOCAL FUNCTIONS
*********************************************************************************************************
*********************************************************************************************************
*/


/*
*********************************************************************************************************
*                                       INITIALIZE RTOS SERVICES
*
* Description : This function creates a semaphore to ensure exclusive access to the LCD module and thus
*               provide thread safe access to the display.
*
* Arguments   : none
*
* Returns     : none
*********************************************************************************************************
*/

void  DispInitOS (void)
{
    OS_ERR  err;

    
    OSMutexCreate((OS_MUTEX  *)&DispLockMutex,                  /* Create display access lock.                          */
                  (CPU_CHAR  *)"uC/LCD Lock",
                  (OS_ERR    *)&err);
    (void)err;
}


/*
*********************************************************************************************************
*                              EXCLUSIVE ACCESS FUNCTIONS TO THE DISPLAY
*
* Description : These functions are used to gain and release exclusive access to the LCD display.
*
* Arguments   : none
*
* Returns     : none
*********************************************************************************************************
*/

void  DispLock (void)
{
    OS_ERR  err;

    
    OSMutexPend((OS_MUTEX  *)&DispLockMutex,                    /* Obtain exclusive access to the display                  */
                (OS_TICK    )0,
                (OS_OPT     )OS_OPT_PEND_BLOCKING,
                (CPU_TS    *)0,
                (OS_ERR    *)&err);

    (void)err;
}


void  DispUnlock (void)
{
    OS_ERR  err;
    
    OSMutexPost((OS_MUTEX *)&DispLockMutex,                     /* Release access to display                               */
                (OS_OPT    )OS_OPT_POST_NONE,
                (OS_ERR   *)&err);

    (void)err;
}
